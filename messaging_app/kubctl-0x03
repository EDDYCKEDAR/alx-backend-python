#!/bin/bash

echo "Applying rolling update to version 2.0..."
kubectl apply -f messaging_app/blue_deployment.yaml

echo "Monitoring rollout status..."
kubectl rollout status deployment django-blue

echo "Testing endpoint with curl (simulate uptime)..."
for i in {1..10}
do
  curl -s http://messaging.local/api/ >> /dev/null
  echo "Request $i sent"
  sleep 1
done

echo "Verifying updated pods..."
kubectl get pods -l app=django-blue
